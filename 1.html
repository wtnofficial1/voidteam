<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<link rel="icon" href="images/VOID.png" />
<title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù† - VOID</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root{
  --primary:#6366f1;
  --primary-dark:#4f46e5;
  --secondary:#ec4899;
  --accent:#14b8a6;
  --success:#10b981;
  --warning:#f59e0b;
  --danger:#ef4444;
  --bg-dark:#0f172a;
  --bg-darker:#020617;
  --bg-card:#1e293b;
  --text-primary:#f1f5f9;
  --text-secondary:#94a3b8;
  --border:#334155;
}

*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden}

body{
  font-family:'Cairo',sans-serif;
  background:linear-gradient(135deg,var(--bg-darker) 0%,var(--bg-dark) 100%);
  color:var(--text-primary);
  display:flex;
  height:100vh;
}

.sidebar{
  width:280px;
  background:rgba(30,41,59,0.8);
  border-left:1px solid var(--border);
  display:flex;
  flex-direction:column;
  backdrop-filter:blur(20px);
}

.sidebar-header{
  padding:30px 20px;
  text-align:center;
  border-bottom:1px solid var(--border);
}

.logo-text{
  font-size:2.5rem;
  font-weight:900;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  margin-bottom:5px;
}

.admin-info{
  font-size:0.9rem;
  color:var(--text-secondary);
  margin-top:10px;
}

.sidebar-nav{
  flex:1;
  padding:20px 0;
  overflow-y:auto;
}

.nav-item{
  padding:15px 25px;
  margin:5px 15px;
  border-radius:12px;
  cursor:pointer;
  transition:all 0.3s;
  display:flex;
  align-items:center;
  gap:12px;
  color:var(--text-secondary);
  font-weight:600;
}

.nav-item:hover{
  background:rgba(99,102,241,0.1);
  color:var(--text-primary);
}

.nav-item.active{
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  color:#fff;
  box-shadow:0 5px 20px rgba(99,102,241,0.4);
}

.nav-icon{
  width:20px;
  height:20px;
}

.logout-btn{
  margin:20px 15px;
  padding:15px;
  background:rgba(239,68,68,0.2);
  border:1px solid rgba(239,68,68,0.4);
  border-radius:12px;
  color:#fff;
  font-weight:700;
  cursor:pointer;
  transition:all 0.3s;
  font-family:'Cairo',sans-serif;
}

.logout-btn:hover{
  background:var(--danger);
  transform:scale(1.02);
}

.main-content{
  flex:1;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.top-bar{
  padding:20px 30px;
  background:rgba(30,41,59,0.6);
  border-bottom:1px solid var(--border);
  backdrop-filter:blur(10px);
}

.page-title{
  font-size:2rem;
  font-weight:900;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

.content-area{
  flex:1;
  padding:30px;
  overflow-y:auto;
}

.content-area::-webkit-scrollbar{
  width:8px;
}

.content-area::-webkit-scrollbar-track{
  background:rgba(255,255,255,0.05);
}

.content-area::-webkit-scrollbar-thumb{
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  border-radius:10px;
}

.page-section{
  display:none;
}

.page-section.active{
  display:block;
  animation:fadeIn 0.3s ease-out;
}

@keyframes fadeIn{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:translateY(0)}
}

.search-filters{
  margin-bottom:30px;
}

.search-box{
  width:100%;
  max-width:500px;
  padding:15px 20px;
  border:2px solid var(--border);
  border-radius:12px;
  background:var(--bg-card);
  color:var(--text-primary);
  font-size:1rem;
  font-family:'Cairo',sans-serif;
  margin-bottom:20px;
  transition:all 0.3s;
}

.search-box:focus{
  outline:none;
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(99,102,241,0.1);
}

.filter-chips{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}

.filter-chip{
  padding:10px 20px;
  border-radius:20px;
  background:var(--bg-card);
  border:1px solid var(--border);
  color:var(--text-secondary);
  cursor:pointer;
  transition:all 0.3s;
  font-weight:600;
}

.filter-chip:hover{
  background:rgba(99,102,241,0.1);
  color:var(--text-primary);
}

.filter-chip.active{
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  border-color:var(--primary);
  color:#fff;
}

.stats-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
  margin-bottom:30px;
}

.stat-card{
  background:var(--bg-card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:25px;
  backdrop-filter:blur(10px);
  transition:all 0.3s;
}

.stat-card:hover{
  transform:translateY(-5px);
  box-shadow:0 10px 30px rgba(99,102,241,0.3);
}

.stat-value{
  font-size:2.5rem;
  font-weight:900;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  margin-bottom:5px;
}

.stat-label{
  color:var(--text-secondary);
  font-size:0.95rem;
}

.tickets-grid{
  display:grid;
  gap:20px;
}

.ticket-item{
  background:var(--bg-card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:20px;
  backdrop-filter:blur(10px);
  transition:all 0.3s;
  display:grid;
  grid-template-columns:60px 1fr auto;
  gap:20px;
  align-items:center;
}

.ticket-item:hover{
  transform:translateY(-3px);
  box-shadow:0 10px 30px rgba(99,102,241,0.3);
  border-color:var(--primary);
}

.ticket-avatar{
  width:60px;
  height:60px;
  border-radius:50%;
  object-fit:cover;
  border:3px solid var(--primary);
}

.ticket-id{
  font-size:0.85rem;
  color:var(--text-secondary);
  font-family:monospace;
}

.ticket-type{
  display:inline-block;
  padding:6px 12px;
  border-radius:8px;
  font-size:0.85rem;
  font-weight:700;
  margin-top:8px;
}

.ticket-type.basic{
  background:rgba(20,184,166,0.2);
  color:var(--accent);
}

.ticket-type.squad{
  background:rgba(139,92,246,0.2);
  color:#8b5cf6;
}

.ticket-type.vip{
  background:rgba(251,191,36,0.2);
  color:#fbbf24;
}

.payment-badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:6px;
  font-size:0.8rem;
  font-weight:600;
  margin-top:5px;
}

.payment-badge.zaincash{
  background:rgba(99,102,241,0.15);
  color:var(--primary);
}

.payment-badge.cash{
  background:rgba(16,185,129,0.15);
  color:var(--success);
}

.status-badge{
  padding:8px 16px;
  border-radius:8px;
  font-size:0.85rem;
  font-weight:700;
}

.status-badge.pending{
  background:rgba(251,191,36,0.2);
  color:#fbbf24;
}

.status-badge.approved{
  background:rgba(16,185,129,0.2);
  color:var(--success);
}

.status-badge.rejected{
  background:rgba(239,68,68,0.2);
  color:var(--danger);
}

.view-details-btn{
  padding:10px 20px;
  border-radius:8px;
  border:none;
  background:var(--primary);
  color:#fff;
  font-weight:700;
  cursor:pointer;
  transition:all 0.3s;
  font-family:'Cairo',sans-serif;
}

.view-details-btn:hover{
  transform:scale(1.05);
  box-shadow:0 5px 20px rgba(99,102,241,0.4);
}

.modal{
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.85);
  backdrop-filter:blur(10px);
  z-index:1000;
  align-items:center;
  justify-content:center;
  padding:20px;
}

.modal.active{
  display:flex;
}

.modal-content{
  background:var(--bg-card);
  border:2px solid var(--border);
  border-radius:24px;
  padding:40px;
  max-width:700px;
  width:100%;
  max-height:90vh;
  overflow-y:auto;
  position:relative;
  backdrop-filter:blur(20px);
}

.modal-content::-webkit-scrollbar{
  width:8px;
}

.modal-content::-webkit-scrollbar-track{
  background:rgba(255,255,255,0.05);
  border-radius:10px;
}

.modal-content::-webkit-scrollbar-thumb{
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  border-radius:10px;
}

.close-modal{
  position:absolute;
  top:20px;
  left:20px;
  background:rgba(255,255,255,0.1);
  border:none;
  width:40px;
  height:40px;
  border-radius:50%;
  cursor:pointer;
  transition:all 0.3s;
  font-size:1.5rem;
  color:#fff;
}

.close-modal:hover{
  background:rgba(239,68,68,0.3);
  transform:rotate(90deg);
}

.modal-header{
  text-align:center;
  margin-bottom:30px;
  padding-bottom:20px;
  border-bottom:1px solid var(--border);
}

.modal-title{
  font-size:1.8rem;
  font-weight:900;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

.detail-row{
  display:flex;
  justify-content:space-between;
  padding:15px 0;
  border-bottom:1px solid rgba(255,255,255,0.05);
}

.detail-label{
  color:var(--text-secondary);
  font-weight:600;
}

.detail-value{
  color:var(--text-primary);
  font-weight:700;
  text-align:left;
}

.price-summary{
  background:rgba(99,102,241,0.1);
  border-radius:12px;
  padding:20px;
  margin:20px 0;
}

.price-row{
  display:flex;
  justify-content:space-between;
  padding:10px 0;
  font-size:1.1rem;
}

.price-row.total{
  font-size:1.5rem;
  font-weight:800;
  color:var(--accent);
  border-top:2px solid rgba(255,255,255,0.1);
  padding-top:15px;
  margin-top:10px;
}

.payment-proof{
  margin:20px 0;
  text-align:center;
}

.payment-proof img{
  max-width:100%;
  max-height:300px;
  border-radius:12px;
  border:2px solid var(--border);
  cursor:pointer;
  transition:all 0.3s;
}

.payment-proof img:hover{
  transform:scale(1.05);
  box-shadow:0 10px 30px rgba(99,102,241,0.3);
}

.modal-actions{
  display:flex;
  gap:15px;
  margin-top:30px;
}

.action-btn{
  flex:1;
  padding:15px;
  border-radius:12px;
  border:none;
  font-size:1.1rem;
  font-weight:700;
  cursor:pointer;
  transition:all 0.3s;
  font-family:'Cairo',sans-serif;
}

.approve-btn{
  background:linear-gradient(135deg,var(--success),#059669);
  color:#fff;
}

.approve-btn:hover{
  transform:scale(1.05);
  box-shadow:0 5px 20px rgba(16,185,129,0.4);
}

.approve-btn:disabled{
  opacity:0.5;
  cursor:not-allowed;
}

.reject-btn{
  background:linear-gradient(135deg,var(--danger),#dc2626);
  color:#fff;
}

.reject-btn:hover{
  transform:scale(1.05);
  box-shadow:0 5px 20px rgba(239,68,68,0.4);
}

.reject-btn:disabled{
  opacity:0.5;
  cursor:not-allowed;
}

.loading-spinner{
  display:inline-block;
  width:20px;
  height:20px;
  border:3px solid rgba(255,255,255,0.3);
  border-top-color:#fff;
  border-radius:50%;
  animation:spin 0.8s linear infinite;
  margin-left:10px;
}

@keyframes spin{
  to{transform:rotate(360deg)}
}

.empty-state{
  text-align:center;
  padding:60px 20px;
  color:var(--text-secondary);
}

.empty-state-icon{
  font-size:4rem;
  margin-bottom:20px;
}

.empty-state-text{
  font-size:1.2rem;
  font-weight:600;
}

.user-card{
  background:var(--bg-card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:20px;
  margin-bottom:15px;
  transition:all 0.3s;
  cursor:pointer;
}

.user-card:hover{
  transform:translateY(-3px);
  box-shadow:0 10px 30px rgba(99,102,241,0.3);
  border-color:var(--primary);
}

.user-header{
  display:flex;
  align-items:center;
  gap:15px;
}

.user-avatar{
  width:60px;
  height:60px;
  border-radius:50%;
  object-fit:cover;
  border:3px solid var(--primary);
}

.user-info{
  flex:1;
}

.user-name{
  font-size:1.2rem;
  font-weight:700;
  margin-bottom:5px;
}

.user-email{
  color:var(--text-secondary);
  font-size:0.9rem;
}

.verified-badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:6px;
  font-size:0.8rem;
  font-weight:600;
  margin-top:5px;
}

.verified-badge.verified{
  background:rgba(16,185,129,0.2);
  color:var(--success);
}

.verified-badge.unverified{
  background:rgba(239,68,68,0.2);
  color:var(--danger);
}

.user-actions{
  display:flex;
  gap:10px;
}

.user-action-btn{
  padding:8px 15px;
  border-radius:8px;
  border:1px solid var(--border);
  background:var(--bg-card);
  color:var(--text-primary);
  font-weight:600;
  cursor:pointer;
  transition:all 0.3s;
  font-family:'Cairo',sans-serif;
  font-size:0.85rem;
}

.user-action-btn:hover{
  background:var(--primary);
  border-color:var(--primary);
  color:#fff;
}

.code-card{
  background:var(--bg-card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:20px;
  margin-bottom:15px;
  transition:all 0.3s;
}

.code-card:hover{
  border-color:var(--primary);
  box-shadow:0 5px 20px rgba(99,102,241,0.2);
}

.code-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}

.code-title{
  font-size:1.2rem;
  font-weight:700;
}

.code-summary{
  color:var(--text-secondary);
  font-size:0.9rem;
  margin-top:5px;
}

.expand-icon{
  transition:transform 0.3s;
  font-size:1.5rem;
  color:var(--primary);
}

.expand-icon.expanded{
  transform:rotate(180deg);
}

.code-details{
  display:none;
  margin-top:20px;
  padding-top:20px;
  border-top:1px solid var(--border);
}

.code-details.active{
  display:block;
}

.ticket-type-stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
  gap:15px;
  margin-top:15px;
}

.ticket-type-stat{
  background:rgba(99,102,241,0.1);
  border-radius:12px;
  padding:15px;
}

.ticket-type-name{
  font-weight:700;
  margin-bottom:10px;
  color:var(--primary);
}

.stat-line{
  display:flex;
  justify-content:space-between;
  margin-top:5px;
  font-size:0.9rem;
}

.log-card{
  background:var(--bg-card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:20px;
  margin-bottom:15px;
  transition:all 0.3s;
}

.log-card:hover{
  border-color:var(--primary);
}

.log-card.search{
  border-right:3px solid var(--accent);
}

.log-card.filter{
  border-right:3px solid var(--warning);
}

.log-card.view{
  border-right:3px solid var(--primary);
}

.log-card.edit{
  border-right:3px solid var(--secondary);
}

.log-card.approve{
  border-right:3px solid var(--success);
}

.log-card.reject{
  border-right:3px solid var(--danger);
}

.log-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}

.log-action{
  font-weight:700;
  font-size:1.1rem;
}

.log-category{
  display:inline-block;
  padding:4px 12px;
  border-radius:6px;
  font-size:0.75rem;
  font-weight:700;
  text-transform:uppercase;
  margin-left:10px;
}

.log-category.search{
  background:rgba(20,184,166,0.2);
  color:var(--accent);
}

.log-category.filter{
  background:rgba(245,158,11,0.2);
  color:var(--warning);
}

.log-category.view{
  background:rgba(99,102,241,0.2);
  color:var(--primary);
}

.log-category.edit{
  background:rgba(236,72,153,0.2);
  color:var(--secondary);
}

.log-category.approve{
  background:rgba(16,185,129,0.2);
  color:var(--success);
}

.log-category.reject{
  background:rgba(239,68,68,0.2);
  color:var(--danger);
}

.log-timestamp{
  color:var(--text-secondary);
  font-size:0.85rem;
}

.log-details{
  color:var(--text-secondary);
  font-size:0.9rem;
  line-height:1.6;
}

.input-group{
  margin-bottom:20px;
}

.input-label{
  display:block;
  margin-bottom:8px;
  font-weight:600;
  color:var(--text-secondary);
}

.input-field{
  width:100%;
  padding:12px 15px;
  border:2px solid var(--border);
  border-radius:8px;
  background:var(--bg-card);
  color:var(--text-primary);
  font-size:1rem;
  font-family:'Cairo',sans-serif;
  transition:all 0.3s;
}

.input-field:focus{
  outline:none;
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(99,102,241,0.1);
}

.editable-value{
  cursor:pointer;
  transition:all 0.3s;
  padding:5px 10px;
  border-radius:6px;
}

.editable-value:hover{
  background:rgba(99,102,241,0.1);
  color:var(--primary);
}

.toast-container{
  position:fixed;
  top:20px;
  left:20px;
  z-index:9999;
  display:flex;
  flex-direction:column;
  gap:10px;
  max-width:400px;
}

.toast{
  background:var(--bg-card);
  border:2px solid var(--border);
  border-radius:12px;
  padding:20px;
  backdrop-filter:blur(20px);
  box-shadow:0 10px 30px rgba(0,0,0,0.5);
  animation:slideInRight 0.3s ease-out;
  display:flex;
  align-items:center;
  gap:15px;
}

.toast.success{
  border-color:var(--success);
}

.toast.error{
  border-color:var(--danger);
}

.toast.warning{
  border-color:var(--warning);
}

.toast.info{
  border-color:var(--primary);
}

.toast-icon{
  font-size:1.5rem;
  min-width:30px;
  text-align:center;
}

.toast-content{
  flex:1;
}

.toast-title{
  font-weight:700;
  margin-bottom:5px;
}

.toast-message{
  font-size:0.9rem;
  color:var(--text-secondary);
}

.toast-close{
  background:none;
  border:none;
  color:var(--text-secondary);
  cursor:pointer;
  font-size:1.2rem;
  padding:0;
  width:24px;
  height:24px;
  transition:all 0.3s;
}

.toast-close:hover{
  color:var(--text-primary);
  transform:rotate(90deg);
}

@keyframes slideInRight{
  from{
    transform:translateX(-100%);
    opacity:0;
  }
  to{
    transform:translateX(0);
    opacity:1;
  }
}

@keyframes slideOutRight{
  from{
    transform:translateX(0);
    opacity:1;
  }
  to{
    transform:translateX(-100%);
    opacity:0;
  }
}
</style>
</head>
<body>

<div class="toast-container" id="toastContainer"></div>

<aside class="sidebar">
  <div class="sidebar-header">
    <div class="logo-text">VOID</div>
    <div class="admin-info">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <span id="adminUsername">Admin</span></div>
  </div>
  
  <nav class="sidebar-nav">
    <div class="nav-item active" data-page="tickets">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>Ø§Ù„ØªØ°Ø§ÙƒØ±</span>
    </div>
    
    <div class="nav-item" data-page="users">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
    </div>
    
    <div class="nav-item" data-page="codes">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©</span>
    </div>
    
    <div class="nav-item" data-page="logs">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span>Ø§Ù„Ø³Ø¬Ù„Ø§Øª</span>
    </div>
  </nav>
  
  <button class="logout-btn" id="logoutBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
</aside>

<main class="main-content">
  <div class="top-bar">
    <h1 class="page-title" id="pageTitle">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ°Ø§ÙƒØ±</h1>
  </div>
  
  <div class="content-area">
    <section class="page-section active" id="ticketsPage">
      <div class="search-filters">
        <input type="text" class="search-box" id="searchBox" placeholder="Ø¨Ø­Ø« Ø¹Ù† ØªØ°ÙƒØ±Ø© (Ù…Ø¹Ø±ÙØŒ Ø§Ø³Ù…ØŒ Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø¨Ø±ÙŠØ¯ØŒ Ø±Ù‚Ù…)...">
        
        <div class="filter-chips">
          <div class="filter-chip active" data-filter="all">Ø§Ù„ÙƒÙ„</div>
          <div class="filter-chip" data-filter="pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
          <div class="filter-chip" data-filter="approved">Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡Ø§</div>
          <div class="filter-chip" data-filter="rejected">Ù…Ø±ÙÙˆØ¶Ø©</div>
          <div class="filter-chip" data-filter="zaincash">Ø²ÙŠÙ† ÙƒØ§Ø´</div>
          <div class="filter-chip" data-filter="cash">ÙƒØ§Ø´</div>
          <div class="filter-chip" data-filter="basic">Basic</div>
          <div class="filter-chip" data-filter="squad">Squad</div>
          <div class="filter-chip" data-filter="vip">VIP</div>
        </div>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="pendingCount">0</div>
          <div class="stat-label">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="approvedCount">0</div>
          <div class="stat-label">ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="rejectedCount">0</div>
          <div class="stat-label">Ù…Ø±ÙÙˆØ¶</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalCount">0</div>
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ°Ø§ÙƒØ±</div>
        </div>
      </div>
      
      <div class="tickets-grid" id="ticketsGrid"></div>
    </section>
    
    <section class="page-section" id="usersPage">
      <div class="search-filters">
        <input type="text" class="search-box" id="userSearchBox" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ø³Ù…ØŒ Ø¨Ø±ÙŠØ¯ØŒ Ù‡Ø§ØªÙØŒ ÙƒÙˆØ¯ Ø¥Ø­Ø§Ù„Ø©)...">
      </div>
      <div id="usersGrid"></div>
    </section>
    
    <section class="page-section" id="codesPage">
      <div class="search-filters">
        <input type="text" class="search-box" id="codeSearchBox" placeholder="Ø¨Ø­Ø« Ø¹Ù† ÙƒÙˆØ¯ Ø¥Ø­Ø§Ù„Ø©...">
      </div>
      <div id="codesGrid"></div>
    </section>
    
    <section class="page-section" id="logsPage">
      <div class="search-filters">
        <input type="text" class="search-box" id="logSearchBox" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª (Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ù…Ø¹Ø±Ù ØªØ°ÙƒØ±Ø©ØŒ Ø¹Ù…Ù„ÙŠØ©)...">
        <div class="filter-chips">
          <div class="filter-chip active" data-log-filter="all">Ø§Ù„ÙƒÙ„</div>
          <div class="filter-chip" data-log-filter="search">Ø¨Ø­Ø«</div>
          <div class="filter-chip" data-log-filter="filter">ÙÙ„ØªØ±</div>
          <div class="filter-chip" data-log-filter="view">Ø¹Ø±Ø¶</div>
          <div class="filter-chip" data-log-filter="edit">ØªØ¹Ø¯ÙŠÙ„</div>
          <div class="filter-chip" data-log-filter="approve">Ù…ÙˆØ§ÙÙ‚Ø©</div>
          <div class="filter-chip" data-log-filter="reject">Ø±ÙØ¶</div>
          <div class="filter-chip" data-log-filter="navigation">ØªÙ†Ù‚Ù„</div>
        </div>
      </div>
      <div id="logsGrid"></div>
    </section>
  </div>
</main>

<div class="modal" id="ticketModal">
  <div class="modal-content">
    <button class="close-modal" id="closeModal">Ã—</button>
    
    <div class="modal-header">
      <div class="modal-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ°ÙƒØ±Ø©</div>
      <div class="ticket-id" id="modalTicketId">#...</div>
    </div>
    
    <div id="modalTicketDetails"></div>
    
    <div class="modal-actions" id="modalActions"></div>
  </div>
</div>

<div class="modal" id="userModal">
  <div class="modal-content">
    <button class="close-modal" id="closeUserModal">Ã—</button>
    
    <div class="modal-header">
      <div class="modal-title">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
    </div>
    
    <div id="modalUserDetails"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, get, set, remove, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyA1GJXtlTU38EUJc33sVBdjq17uK_dPcAI",
  authDomain: "t7di-wtn.firebaseapp.com",
  databaseURL: "https://t7di-wtn-default-rtdb.firebaseio.com",
  projectId: "t7di-wtn",
  storageBucket: "t7di-wtn.firebasestorage.app",
  messagingSenderId: "156578457028",
  appId: "1:156578457028:web:33164036f0fa1b1066b091",
  measurementId: "G-DC212XC47M"
};

const app = initializeApp(firebaseConfig);
const database = getDatabase(app);

const adminUser = sessionStorage.getItem('adminUser');
if (!adminUser) {
  window.location.href = 'admin.html';
}

document.getElementById('adminUsername').textContent = adminUser;

function showToast(title, message, type = 'info') {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  
  const icons = {
    success: 'âœ“',
    error: 'âœ—',
    warning: 'âš ',
    info: 'â„¹'
  };
  
  toast.innerHTML = `
    <div class="toast-icon">${icons[type] || icons.info}</div>
    <div class="toast-content">
      <div class="toast-title">${title}</div>
      <div class="toast-message">${message}</div>
    </div>
    <button class="toast-close">Ã—</button>
  `;
  
  container.appendChild(toast);
  
  const closeBtn = toast.querySelector('.toast-close');
  closeBtn.addEventListener('click', () => {
    toast.style.animation = 'slideOutRight 0.3s ease-out';
    setTimeout(() => toast.remove(), 300);
  });
  
  setTimeout(() => {
    toast.style.animation = 'slideOutRight 0.3s ease-out';
    setTimeout(() => toast.remove(), 300);
  }, 5000);
}

async function logAction(action, category, details = {}) {
  try {
    const logId = '-' + Date.now().toString();
    await update(ref(database), {
      [`admin_logs/${adminUser}/actions/${logId}`]: {
        action,
        category,
        admin: adminUser,
        browser: navigator.userAgent,
        details,
        timestamp: new Date().toISOString()
      }
    });
  } catch (error) {
    console.error('Error logging action:', error);
  }
}

document.getElementById('logoutBtn').addEventListener('click', () => {
  logAction('logout', 'navigation', { message: 'ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…' });
  sessionStorage.clear();
  window.location.href = 'admin.html';
});

document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', () => {
    const page = item.dataset.page;
    
    logAction('page_navigation', 'navigation', {
      from: document.getElementById('pageTitle').textContent,
      to: page
    });
    
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    item.classList.add('active');
    
    document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
    document.getElementById(page + 'Page').classList.add('active');
    
    const titles = {
      tickets: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ°Ø§ÙƒØ±',
      users: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',
      codes: 'Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©',
      logs: 'Ø§Ù„Ø³Ø¬Ù„Ø§Øª'
    };
    document.getElementById('pageTitle').textContent = titles[page];
    
    if (page === 'users') loadUsers();
    if (page === 'codes') loadCodes();
    if (page === 'logs') loadLogs();
  });
});

let allTickets = [];
let allUsers = {};
let allCodes = [];
let allLogs = [];
let currentFilter = 'all';
let currentLogFilter = 'all';
let searchQuery = '';
let codeSearchQuery = '';
let logSearchQuery = '';

const POINTS_MAP = {
  'Basic Ticket': 10,
  'Squad Ticket': 20,
  'VIP Ticket': 30
};

async function loadTickets() {
  try {
    const ticketsRef = ref(database, 'tickets');
    const doneTicketsRef = ref(database, 'donetickets');
    const dontTicketsRef = ref(database, 'donttickets');
    const usersRef = ref(database, 'users');
    
    const [ticketsSnap, doneSnap, dontSnap, usersSnap] = await Promise.all([
      get(ticketsRef),
      get(doneTicketsRef),
      get(dontTicketsRef),
      get(usersRef)
    ]);
    
    if (usersSnap.exists()) {
      allUsers = usersSnap.val();
    }
    
    allTickets = [];
    
    if (ticketsSnap.exists()) {
      const ticketsData = ticketsSnap.val();
      Object.keys(ticketsData).forEach(paymentType => {
        if (ticketsData[paymentType] && typeof ticketsData[paymentType] === 'object') {
          Object.keys(ticketsData[paymentType]).forEach(ticketTypeKey => {
            if (ticketsData[paymentType][ticketTypeKey] && typeof ticketsData[paymentType][ticketTypeKey] === 'object') {
              Object.keys(ticketsData[paymentType][ticketTypeKey]).forEach(ticketId => {
                const ticket = ticketsData[paymentType][ticketTypeKey][ticketId];
                if (ticket && ticket.status === 'pending') {
                  allTickets.push({
                    ...ticket,
                    id: ticketId,
                    paymentType,
                    ticketTypeKey,
                    status: 'pending'
                  });
                }
              });
            }
          });
        }
      });
    }
    
    if (doneSnap.exists()) {
      const doneData = doneSnap.val();
      Object.keys(doneData).forEach(paymentType => {
        if (doneData[paymentType] && typeof doneData[paymentType] === 'object') {
          Object.keys(doneData[paymentType]).forEach(ticketTypeKey => {
            if (doneData[paymentType][ticketTypeKey] && typeof doneData[paymentType][ticketTypeKey] === 'object') {
              Object.keys(doneData[paymentType][ticketTypeKey]).forEach(ticketId => {
                const ticket = doneData[paymentType][ticketTypeKey][ticketId];
                if (ticket) {
                  allTickets.push({
                    ...ticket,
                    id: ticketId,
                    paymentType,
                    ticketTypeKey,
                    status: 'approved'
                  });
                }
              });
            }
          });
        }
      });
    }
    
    if (dontSnap.exists()) {
      const dontData = dontSnap.val();
      if (typeof dontData === 'object' && dontData !== null) {
        Object.keys(dontData).forEach(paymentType => {
          if (dontData[paymentType] && typeof dontData[paymentType] === 'object') {
            Object.keys(dontData[paymentType]).forEach(ticketTypeKey => {
              if (dontData[paymentType][ticketTypeKey] && typeof dontData[paymentType][ticketTypeKey] === 'object') {
                Object.keys(dontData[paymentType][ticketTypeKey]).forEach(ticketId => {
                  const ticket = dontData[paymentType][ticketTypeKey][ticketId];
                  if (ticket) {
                    allTickets.push({
                      ...ticket,
                      id: ticketId,
                      paymentType,
                      ticketTypeKey,
                      status: 'rejected'
                    });
                  }
                });
              }
            });
          }
        });
      }
    }
    
    allTickets.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
    
    updateStats();
    filterTickets();
  } catch (error) {
    console.error('Error loading tickets:', error);
  }
}

function updateStats() {
  const pending = allTickets.filter(t => t.status === 'pending').length;
  const approved = allTickets.filter(t => t.status === 'approved').length;
  const rejected = allTickets.filter(t => t.status === 'rejected').length;
  
  document.getElementById('pendingCount').textContent = pending;
  document.getElementById('approvedCount').textContent = approved;
  document.getElementById('rejectedCount').textContent = rejected;
  document.getElementById('totalCount').textContent = allTickets.length;
}

function filterTickets() {
  let filtered = allTickets;
  
  if (currentFilter !== 'all') {
    if (currentFilter === 'pending' || currentFilter === 'approved' || currentFilter === 'rejected') {
      filtered = filtered.filter(t => t.status === currentFilter);
    } else if (currentFilter === 'zaincash' || currentFilter === 'cash') {
      filtered = filtered.filter(t => t.paymentType === currentFilter);
    } else if (currentFilter === 'basic' || currentFilter === 'squad' || currentFilter === 'vip') {
      filtered = filtered.filter(t => t.ticketType?.toLowerCase().includes(currentFilter));
    }
  }
  
  if (searchQuery) {
    const query = searchQuery.toLowerCase();
    filtered = filtered.filter(t => 
      t.id.toLowerCase().includes(query) ||
      t.fullName?.toLowerCase().includes(query) ||
      t.username?.toLowerCase().includes(query) ||
      t.email?.toLowerCase().includes(query) ||
      t.whatsapp?.toLowerCase().includes(query) ||
      t.phonezaincash?.toLowerCase().includes(query)
    );
  }
  
  renderTickets(filtered);
}

function renderTickets(tickets) {
  const grid = document.getElementById('ticketsGrid');
  
  if (tickets.length === 0) {
    grid.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ“­</div>
        <div class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°Ø§ÙƒØ±</div>
      </div>
    `;
    return;
  }
  
  grid.innerHTML = tickets.map(ticket => {
    const ticketTypeClass = ticket.ticketType?.toLowerCase().includes('basic') ? 'basic' :
                           ticket.ticketType?.toLowerCase().includes('squad') ? 'squad' : 'vip';
    
    const user = Object.values(allUsers).find(u => u.email === ticket.email);
    const userProfile = user?.profile || 'https://via.placeholder.com/60';
    
    return `
      <div class="ticket-item" data-ticket-id="${ticket.id}">
        <div>
          <img src="${userProfile}" alt="User" class="ticket-avatar" onerror="this.src='https://via.placeholder.com/60'">
        </div>
        <div>
          <div class="ticket-id">#${ticket.id.substring(0, 16)}...</div>
          <div><strong>${ticket.fullName || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</strong></div>
          <div style="font-size:0.9rem;color:var(--text-secondary);margin-top:5px;">
            ${ticket.username || ''}
          </div>
          <span class="ticket-type ${ticketTypeClass}">${ticket.ticketType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
          <span class="payment-badge ${ticket.paymentType}">${ticket.paymentMethod || ticket.paymentType}</span>
        </div>
        <div style="text-align:center;">
          <span class="status-badge ${ticket.status}">
            ${ticket.status === 'pending' ? 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±' : 
              ticket.status === 'approved' ? 'Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡Ø§' : 'Ù…Ø±ÙÙˆØ¶Ø©'}
          </span>
          <button class="view-details-btn" onclick="window.viewTicketDetails('${ticket.id}')">
            Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
          </button>
        </div>
      </div>
    `;
  }).join('');
}

window.viewTicketDetails = function(ticketId) {
  const ticket = allTickets.find(t => t.id === ticketId);
  if (!ticket) return;
  
  logAction('view_ticket_details', 'view', {
    ticketId: ticket.id,
    ticketType: ticket.ticketType,
    status: ticket.status,
    username: ticket.username
  });
  
  document.getElementById('modalTicketId').textContent = `#${ticket.id}`;
  
  let details = `
    <div class="detail-row">
      <span class="detail-label">Ø§Ù„Ø§Ø³Ù…</span>
      <span class="detail-value">${ticket.fullName || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</span>
      <span class="detail-value">${ticket.username || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Ø§Ù„Ø¨Ø±ÙŠØ¯</span>
      <span class="detail-value">${ticket.email || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Ø§Ù„Ù‡Ø§ØªÙ</span>
      <span class="detail-value">${ticket.whatsapp || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</span>
    </div>
  `;
  
  if (ticket.paymentType === 'zaincash' && ticket.phonezaincash) {
    details += `
      <div class="detail-row">
        <span class="detail-label">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙˆÙ„ Ù…Ù†Ù‡</span>
        <span class="detail-value">${ticket.phonezaincash}</span>
      </div>
    `;
  }
  
  details += `
    <div class="detail-row">
      <span class="detail-label">Ù†ÙˆØ¹ Ø§Ù„ØªØ°ÙƒØ±Ø©</span>
      <span class="detail-value">${ticket.ticketType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</span>
      <span class="detail-value">${ticket.paymentMethod || ticket.paymentType}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</span>
      <span class="detail-value">${new Date(ticket.timestamp).toLocaleDateString('en-US', {year: 'numeric', month: '2-digit', day: '2-digit'})} ${new Date(ticket.timestamp).toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'})}</span>
    </div>
    ${ticket.discountCode || ticket.invitecode ? `
    <div class="detail-row">
      <span class="detail-label">ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…</span>
      <span class="detail-value">${ticket.discountCode || ticket.invitecode}</span>
    </div>
    ` : ''}
    
    <div class="price-summary">
      <div class="price-row">
        <span>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ</span>
        <span>${ticket.ticketPrice || ticket.originalPrice || 0} JOD</span>
      </div>
      ${ticket.discountAmount ? `
      <div class="price-row">
        <span>Ø§Ù„Ø®ØµÙ…</span>
        <span style="color:var(--success);">-${ticket.discountAmount} JOD</span>
      </div>
      ` : ''}
      <div class="price-row total">
        <span>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span>
        <span>${ticket.finalPrice || ticket.finalPriceAfterDiscount || 0} JOD</span>
      </div>
    </div>
    
    ${ticket.paymentProofUrl ? `
    <div class="payment-proof">
      <h3 style="margin-bottom:15px;color:var(--text-secondary);">Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹</h3>
      <img src="${ticket.paymentProofUrl}" alt="Payment Proof" onclick="window.open('${ticket.paymentProofUrl}', '_blank')">
    </div>
    ` : ''}
  `;
  
  document.getElementById('modalTicketDetails').innerHTML = details;
  
  const actionsDiv = document.getElementById('modalActions');
  if (ticket.status === 'pending') {
    actionsDiv.innerHTML = `
      <button class="action-btn approve-btn" onclick="window.approveTicket('${ticket.id}')">
        Ù…ÙˆØ§ÙÙ‚Ø©
      </button>
      <button class="action-btn reject-btn" onclick="window.rejectTicket('${ticket.id}')">
        Ø±ÙØ¶
      </button>
    `;
  } else {
    actionsDiv.innerHTML = `
      <div style="text-align:center;width:100%;padding:20px;color:var(--text-secondary);">
        ${ticket.status === 'approved' ? 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„ØªØ°ÙƒØ±Ø©' : 'ØªÙ… Ø±ÙØ¶ Ù‡Ø°Ù‡ Ø§Ù„ØªØ°ÙƒØ±Ø©'}
      </div>
    `;
  }
  
  document.getElementById('ticketModal').classList.add('active');
};

window.approveTicket = async function(ticketId) {
  const ticket = allTickets.find(t => t.id === ticketId);
  if (!ticket) return;
  
  const approveBtn = document.querySelector('.approve-btn');
  const rejectBtn = document.querySelector('.reject-btn');
  
  approveBtn.disabled = true;
  rejectBtn.disabled = true;
  approveBtn.innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©... <span class="loading-spinner"></span>';
  
  try {
    const updates = {};
    const ticketPoints = POINTS_MAP[ticket.ticketType] || 0;
    
    const approvedTicket = {
      ...ticket,
      status: 'approved',
      approvedAt: new Date().toISOString(),
      approvedBy: adminUser,
      points: ticketPoints
    };
    
    updates[`donetickets/${ticket.paymentType}/${ticket.ticketTypeKey}/${ticketId}`] = approvedTicket;
    updates[`tickets/${ticket.paymentType}/${ticket.ticketTypeKey}/${ticketId}`] = null;
    
    if (ticket.invitecode && ticket.invitecode !== '' && ticket.invitecode !== 'none') {
      const inviteRef = ref(database, `invite/${ticket.invitecode}`);
      const inviteSnap = await get(inviteRef);
      
      if (inviteSnap.exists()) {
        const inviteData = inviteSnap.val();
        const ticketTypeKey = ticket.ticketTypeKey;
        
        const oldRequestsPoints = inviteData[ticketTypeKey]?.requests_points || 0;
        const oldPoints = inviteData[ticketTypeKey]?.points || 0;
        const oldAllRequestsPoints = inviteData.allrequestspoints || 0;
        const oldAllPoints = inviteData.allpoints || 0;
        
        const newRequestsPoints = Math.max(0, oldRequestsPoints - ticketPoints);
        const newPoints = oldPoints + ticketPoints;
        const newAllRequestsPoints = Math.max(0, oldAllRequestsPoints - ticketPoints);
        const newAllPoints = oldAllPoints + ticketPoints;
        
        updates[`invite/${ticket.invitecode}/${ticketTypeKey}/requests_points`] = newRequestsPoints;
        updates[`invite/${ticket.invitecode}/${ticketTypeKey}/points`] = newPoints;
        updates[`invite/${ticket.invitecode}/allrequestspoints`] = newAllRequestsPoints;
        updates[`invite/${ticket.invitecode}/allpoints`] = newAllPoints;
        
        if (inviteData[ticketTypeKey]?.use?.[ticket.username]) {
          updates[`invite/${ticket.invitecode}/${ticketTypeKey}/use/${ticket.username}/approved`] = true;
        }
      }
    }
    
    await update(ref(database), updates);
    
    await logAction('approve_ticket', 'approve', {
      ticketId: ticketId,
      ticketType: ticket.ticketType,
      username: ticket.username,
      discountCode: ticket.discountCode || ticket.invitecode || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯',
      paymentMethod: ticket.paymentMethod,
      points: ticketPoints
    });
    
    await loadTickets();
    
    document.getElementById('ticketModal').classList.remove('active');
    
    showToast('Ù†Ø¬Ø­!', 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ°ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
  } catch (error) {
    console.error('Error approving ticket:', error);
    showToast('Ø®Ø·Ø£!', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ°ÙƒØ±Ø©', 'error');
    approveBtn.disabled = false;
    rejectBtn.disabled = false;
    approveBtn.textContent = 'Ù…ÙˆØ§ÙÙ‚Ø©';
  }
};

window.rejectTicket = async function(ticketId) {
  const ticket = allTickets.find(t => t.id === ticketId);
  if (!ticket) return;
  
  if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¶ Ù‡Ø°Ù‡ Ø§Ù„ØªØ°ÙƒØ±Ø©ØŸ')) return;
  
  const approveBtn = document.querySelector('.approve-btn');
  const rejectBtn = document.querySelector('.reject-btn');
  
  approveBtn.disabled = true;
  rejectBtn.disabled = true;
  rejectBtn.innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©... <span class="loading-spinner"></span>';
  
  try {
    const updates = {};
    
    const rejectedTicket = {
      ...ticket,
      status: 'rejected',
      rejectedAt: new Date().toISOString(),
      rejectedBy: adminUser
    };
    
    updates[`donttickets/${ticket.paymentType}/${ticket.ticketTypeKey}/${ticketId}`] = rejectedTicket;
    updates[`tickets/${ticket.paymentType}/${ticket.ticketTypeKey}/${ticketId}`] = null;
    
    if (ticket.invitecode && ticket.invitecode !== '' && ticket.invitecode !== 'none') {
      const inviteRef = ref(database, `invite/${ticket.invitecode}`);
      const inviteSnap = await get(inviteRef);
      
      if (inviteSnap.exists()) {
        const inviteData = inviteSnap.val();
        const ticketTypeKey = ticket.ticketTypeKey;
        const ticketPoints = POINTS_MAP[ticket.ticketType] || 0;
        
        const oldRequestsPoints = inviteData[ticketTypeKey]?.requests_points || 0;
        const oldAllRequestsPoints = inviteData.allrequestspoints || 0;
        
        updates[`invite/${ticket.invitecode}/${ticketTypeKey}/requests_points`] = Math.max(0, oldRequestsPoints - ticketPoints);
        updates[`invite/${ticket.invitecode}/allrequestspoints`] = Math.max(0, oldAllRequestsPoints - ticketPoints);
        
        if (inviteData[ticketTypeKey]?.use?.[ticket.username]) {
          updates[`invite/${ticket.invitecode}/${ticketTypeKey}/use/${ticket.username}`] = null;
        }
      }
    }
    
    await update(ref(database), updates);
    
    await logAction('reject_ticket', 'reject', {
      ticketId: ticketId,
      ticketType: ticket.ticketType,
      username: ticket.username,
      discountCode: ticket.discountCode || ticket.invitecode || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯',
      paymentMethod: ticket.paymentMethod
    });
    
    await loadTickets();
    
    document.getElementById('ticketModal').classList.remove('active');
    
    showToast('Ù†Ø¬Ø­!', 'ØªÙ… Ø±ÙØ¶ Ø§Ù„ØªØ°ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
  } catch (error) {
    console.error('Error rejecting ticket:', error);
    showToast('Ø®Ø·Ø£!', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¶ Ø§Ù„ØªØ°ÙƒØ±Ø©', 'error');
    approveBtn.disabled = false;
    rejectBtn.disabled = false;
    rejectBtn.textContent = 'Ø±ÙØ¶';
  }
};

async function loadUsers() {
  try {
    const usersRef = ref(database, 'users');
    const usersSnap = await get(usersRef);
    
    if (!usersSnap.exists()) {
      document.getElementById('usersGrid').innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">ğŸ‘¥</div>
          <div class="empty-state-text">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
        </div>
      `;
      return;
    }
    
    const usersData = usersSnap.val();
    const usersArray = Object.entries(usersData).map(([id, data]) => ({id, ...data}));
    
    renderUsers(usersArray);
  } catch (error) {
    console.error('Error loading users:', error);
  }
}

function renderUsers(users) {
  const grid = document.getElementById('usersGrid');
  
  if (users.length === 0) {
    grid.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ‘¥</div>
        <div class="empty-state-text">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
      </div>
    `;
    return;
  }
  
  grid.innerHTML = users.map(user => `
    <div class="user-card">
      <div class="user-header">
        <img src="${user.profile || 'https://via.placeholder.com/60'}" alt="User" class="user-avatar" onerror="this.src='https://via.placeholder.com/60'">
        <div class="user-info">
          <div class="user-name">${user.user || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <div class="user-email">${user.email || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
          <span class="verified-badge ${user.verified ? 'verified' : 'unverified'}">
            ${user.verified ? 'âœ“ Ù…ÙˆØ«Ù‚' : 'âš  ØºÙŠØ± Ù…ÙˆØ«Ù‚'}
          </span>
        </div>
      </div>
      <div style="margin-top:15px;color:var(--text-secondary);font-size:0.9rem;">
        <div>Ø§Ù„Ù‡Ø§ØªÙ: ${user.phone || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
        <div>ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©: ${user.invitecode || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
      </div>
      <div class="user-actions" style="margin-top:15px;">
        <button class="user-action-btn" onclick="window.editUser('${user.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="user-action-btn" onclick="window.toggleVerification('${user.id}', ${!user.verified})">
          ${user.verified ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚' : 'ØªÙˆØ«ÙŠÙ‚'}
        </button>
      </div>
    </div>
  `).join('');
}

window.editUser = async function(userId) {
  try {
    const userRef = ref(database, `users/${userId}`);
    const userSnap = await get(userRef);
    
    if (!userSnap.exists()) {
      showToast('Ø®Ø·Ø£!', 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
      return;
    }
    
    const userData = userSnap.val();
    
    logAction('open_user_edit', 'view', {
      userId: userId,
      user: userData.user,
      email: userData.email
    });
    
    let invitePoints = 0;
    if (userData.invitecode) {
      const inviteRef = ref(database, `invite/${userData.invitecode}`);
      const inviteSnap = await get(inviteRef);
      if (inviteSnap.exists()) {
        const inviteData = inviteSnap.val();
        invitePoints = inviteData.allpoints || 0;
      }
    }
    
    const modalDetails = document.getElementById('modalUserDetails');
    modalDetails.innerHTML = `
      <div class="input-group">
        <label class="input-label">Ø§Ù„ÙŠÙˆØ²Ø±</label>
        <input type="text" class="input-field" id="editUserName" value="${userData.user || ''}" placeholder="Ø§Ù„ÙŠÙˆØ²Ø±">
      </div>
      <div class="input-group">
        <label class="input-label">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
        <input type="text" class="input-field" id="editUserProfile" value="${userData.profile || ''}" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
      </div>
      <div class="input-group">
        <label class="input-label">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù…Ù† ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©: ${userData.invitecode || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'})</label>
        <input type="number" class="input-field" id="editUserPoints" value="${invitePoints}" placeholder="Ø§Ù„Ù†Ù‚Ø§Ø·">
        <div style="margin-top:8px;color:var(--text-secondary);font-size:0.85rem;">
          Ù…Ù„Ø§Ø­Ø¸Ø©: Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©
        </div>
      </div>
      <div style="display:flex;gap:15px;margin-top:30px;">
        <button class="action-btn approve-btn" onclick="window.saveUserEdit('${userId}')">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
        <button class="action-btn reject-btn" onclick="document.getElementById('userModal').classList.remove('active')">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    `;
    
    document.getElementById('userModal').classList.add('active');
  } catch (error) {
    console.error('Error editing user:', error);
    showToast('Ø®Ø·Ø£!', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
  }
};

window.saveUserEdit = async function(userId) {
  try {
    const userRef = ref(database, `users/${userId}`);
    const userSnap = await get(userRef);
    
    if (!userSnap.exists()) {
      showToast('Ø®Ø·Ø£!', 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
      return;
    }
    
    const userData = userSnap.val();
    const newUserName = document.getElementById('editUserName').value;
    const newProfile = document.getElementById('editUserProfile').value;
    const newPoints = parseInt(document.getElementById('editUserPoints').value) || 0;
    
    const updates = {};
    const changes = [];
    
    if (newUserName && newUserName !== userData.user) {
      updates[`users/${userId}/user`] = newUserName;
      changes.push(`Ø§Ù„ÙŠÙˆØ²Ø±: ${userData.user} â† ${newUserName}`);
    }
    
    if (newProfile && newProfile !== userData.profile) {
      updates[`users/${userId}/profile`] = newProfile;
      changes.push(`Ø§Ù„ØµÙˆØ±Ø©: ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«`);
    }
    
    if (userData.invitecode) {
      const inviteRef = ref(database, `invite/${userData.invitecode}`);
      const inviteSnap = await get(inviteRef);
      
      if (inviteSnap.exists()) {
        const inviteData = inviteSnap.val();
        const currentPoints = inviteData.allpoints || 0;
        
        if (newPoints !== currentPoints) {
          updates[`invite/${userData.invitecode}/allpoints`] = newPoints;
          changes.push(`Ø§Ù„Ù†Ù‚Ø§Ø·: ${currentPoints} â† ${newPoints}`);
        }
      }
    }
    
    await update(ref(database), updates);
    
    await logAction('edit_user', 'edit', {
      userId: userId,
      user: userData.user,
      email: userData.email,
      changes: changes.join(', ')
    });
    
    document.getElementById('userModal').classList.remove('active');
    showToast('Ù†Ø¬Ø­!', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
    loadUsers();
  } catch (error) {
    console.error('Error saving user edit:', error);
    showToast('Ø®Ø·Ø£!', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª', 'error');
  }
};

window.toggleVerification = async function(userId, verified) {
  try {
    const userRef = ref(database, `users/${userId}`);
    const userSnap = await get(userRef);
    
    if (!userSnap.exists()) {
      showToast('Ø®Ø·Ø£!', 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
      return;
    }
    
    const userData = userSnap.val();
    
    await update(ref(database, `users/${userId}`), {verified});
    
    await logAction('toggle_user_verification', 'edit', {
      userId,
      user: userData.user,
      email: userData.email,
      verified,
      action: verified ? 'ØªÙˆØ«ÙŠÙ‚' : 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚'
    });
    
    showToast('Ù†Ø¬Ø­!', verified ? 'ØªÙ… ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­' : 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'success');
    loadUsers();
  } catch (error) {
    console.error('Error toggling verification:', error);
    showToast('Ø®Ø·Ø£!', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚', 'error');
  }
};

async function loadCodes() {
  try {
    const inviteRef = ref(database, 'invite');
    const inviteSnap = await get(inviteRef);
    
    if (!inviteSnap.exists()) {
      document.getElementById('codesGrid').innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">ğŸŸï¸</div>
          <div class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ø¥Ø­Ø§Ù„Ø©</div>
        </div>
      `;
      return;
    }
    
    const codesData = inviteSnap.val();
    allCodes = Object.entries(codesData).map(([code, data]) => ({code, ...data}));
    
    filterCodes();
  } catch (error) {
    console.error('Error loading codes:', error);
  }
}

function filterCodes() {
  let filtered = allCodes;
  
  if (codeSearchQuery) {
    const query = codeSearchQuery.toLowerCase();
    filtered = filtered.filter(code => 
      code.code.toLowerCase().includes(query)
    );
  }
  
  renderCodes(filtered);
}

function renderCodes(codes) {
  const grid = document.getElementById('codesGrid');
  
  if (codes.length === 0) {
    grid.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">ğŸŸï¸</div>
        <div class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ø¥Ø­Ø§Ù„Ø©</div>
      </div>
    `;
    return;
  }
  
  grid.innerHTML = codes.map((codeData, index) => `
    <div class="code-card">
      <div class="code-header" onclick="toggleCodeDetails(${index})">
        <div>
          <div class="code-title">ÙƒÙˆØ¯: ${codeData.code}</div>
          <div class="code-summary">
            Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©: ${codeData.allpoints || 0} | Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±: ${codeData.allrequestspoints || 0}
          </div>
        </div>
        <span class="expand-icon" id="expand-${index}">â–¼</span>
      </div>
      <div class="code-details" id="details-${index}">
        <div class="ticket-type-stats">
          ${['basic_ticket', 'squad_ticket', 'vip_ticket'].map(type => {
            const typeData = codeData[type] || {};
            const typeName = type === 'basic_ticket' ? 'Basic Ticket' : type === 'squad_ticket' ? 'Squad Ticket' : 'VIP Ticket';
            return `
              <div class="ticket-type-stat">
                <div class="ticket-type-name">${typeName}</div>
                <div class="stat-line">
                  <span>Ù†Ù‚Ø§Ø·:</span>
                  <span class="editable-value" onclick="window.editCodePoints('${codeData.code}', '${type}', 'points', ${typeData.points || 0})">${typeData.points || 0}</span>
                </div>
                <div class="stat-line">
                  <span>Ø§Ù†ØªØ¸Ø§Ø±:</span>
                  <span class="editable-value" onclick="window.editCodePoints('${codeData.code}', '${type}', 'requests_points', ${typeData.requests_points || 0})">${typeData.requests_points || 0}</span>
                </div>
              </div>
            `;
          }).join('')}
        </div>
        <div style="margin-top:15px;">
          <div class="stat-line">
            <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©:</span>
            <span class="editable-value" onclick="window.editCodeTotalPoints('${codeData.code}', 'allpoints', ${codeData.allpoints || 0})">${codeData.allpoints || 0}</span>
          </div>
          <div class="stat-line">
            <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±:</span>
            <span class="editable-value" onclick="window.editCodeTotalPoints('${codeData.code}', 'allrequestspoints', ${codeData.allrequestspoints || 0})">${codeData.allrequestspoints || 0}</span>
          </div>
        </div>
      </div>
    </div>
  `).join('');
}

window.toggleCodeDetails = function(index) {
  const details = document.getElementById(`details-${index}`);
  const icon = document.getElementById(`expand-${index}`);
  
  const code = allCodes[index];
  
  logAction('toggle_code_details', 'view', {
    code: code.code,
    expanded: !details.classList.contains('active')
  });
  
  details.classList.toggle('active');
  icon.classList.toggle('expanded');
};

window.editCodePoints = async function(code, type, field, currentValue) {
  const newValue = prompt(`Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù€ ${field}:`, currentValue);
  if (newValue === null || newValue === currentValue.toString()) return;
  
  try {
    await update(ref(database, `invite/${code}/${type}`), {
      [field]: parseInt(newValue) || 0
    });
    
    await logAction('edit_code_points', 'edit', {
      code,
      type,
      field,
      oldValue: currentValue,
      newValue: parseInt(newValue) || 0
    });
    
    showToast('Ù†Ø¬Ø­!', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨Ù†Ø¬Ø§Ø­', 'success');
    loadCodes();
  } catch (error) {
    console.error('Error updating code points:', error);
    showToast('Ø®Ø·Ø£!', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'error');
  }
};

window.editCodeTotalPoints = async function(code, field, currentValue) {
  const newValue = prompt(`Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:`, currentValue);
  if (newValue === null || newValue === currentValue.toString()) return;
  
  try {
    await update(ref(database, `invite/${code}`), {
      [field]: parseInt(newValue) || 0
    });
    
    await logAction('edit_code_total_points', 'edit', {
      code,
      field,
      oldValue: currentValue,
      newValue: parseInt(newValue) || 0
    });
    
    showToast('Ù†Ø¬Ø­!', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨Ù†Ø¬Ø§Ø­', 'success');
    loadCodes();
  } catch (error) {
    console.error('Error updating total points:', error);
    showToast('Ø®Ø·Ø£!', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'error');
  }
};

async function loadLogs() {
  try {
    const logsRef = ref(database, 'admin_logs');
    const logsSnap = await get(logsRef);
    
    if (!logsSnap.exists()) {
      document.getElementById('logsGrid').innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">ğŸ“‹</div>
          <div class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</div>
        </div>
      `;
      return;
    }
    
    const logsData = logsSnap.val();
    allLogs = [];
    
    Object.entries(logsData).forEach(([admin, data]) => {
      if (data.actions) {
        Object.entries(data.actions).forEach(([id, action]) => {
          allLogs.push({...action, admin, id});
        });
      }
    });
    
    allLogs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
    
    filterLogs();
  } catch (error) {
    console.error('Error loading logs:', error);
  }
}

function filterLogs() {
  let filtered = allLogs;
  
  if (currentLogFilter !== 'all') {
    filtered = filtered.filter(log => log.category === currentLogFilter);
  }
  
  if (logSearchQuery) {
    const query = logSearchQuery.toLowerCase();
    filtered = filtered.filter(log => {
      const details = log.details || {};
      return (
        log.admin?.toLowerCase().includes(query) ||
        log.action?.toLowerCase().includes(query) ||
        details.user?.toLowerCase().includes(query) ||
        details.username?.toLowerCase().includes(query) ||
        details.ticketId?.toLowerCase().includes(query) ||
        details.userId?.toLowerCase().includes(query) ||
        details.code?.toLowerCase().includes(query)
      );
    });
  }
  
  renderLogs(filtered);
}

function renderLogs(logs) {
  const grid = document.getElementById('logsGrid');
  
  if (logs.length === 0) {
    grid.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ“‹</div>
        <div class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</div>
      </div>
    `;
    return;
  }
  
  grid.innerHTML = logs.map(log => {
    const actionNames = {
      'approve_ticket': 'Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ ØªØ°ÙƒØ±Ø©',
      'reject_ticket': 'Ø±ÙØ¶ ØªØ°ÙƒØ±Ø©',
      'toggle_user_verification': 'ØªØºÙŠÙŠØ± ØªÙˆØ«ÙŠÙ‚ Ù…Ø³ØªØ®Ø¯Ù…',
      'view_ticket_details': 'Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ ØªØ°ÙƒØ±Ø©',
      'open_user_edit': 'ÙØªØ­ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…',
      'edit_user': 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù…',
      'toggle_code_details': 'Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ ÙƒÙˆØ¯',
      'edit_code_points': 'ØªØ¹Ø¯ÙŠÙ„ Ù†Ù‚Ø§Ø· ÙƒÙˆØ¯',
      'edit_code_total_points': 'ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù†Ù‚Ø§Ø· ÙƒÙˆØ¯',
      'search_tickets': 'Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ØªØ°Ø§ÙƒØ±',
      'search_users': 'Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',
      'search_codes': 'Ø¨Ø­Ø« ÙÙŠ Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©',
      'search_logs': 'Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª',
      'filter_tickets': 'ÙÙ„ØªØ±Ø© Ø§Ù„ØªØ°Ø§ÙƒØ±',
      'filter_logs': 'ÙÙ„ØªØ±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª',
      'page_navigation': 'Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª',
      'logout': 'ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬'
    };
    
    const actionName = actionNames[log.action] || log.action;
    const details = log.details || {};
    const timestamp = new Date(log.timestamp);
    const formattedDate = timestamp.toLocaleDateString('en-US', {year: 'numeric', month: '2-digit', day: '2-digit'});
    const formattedTime = timestamp.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'});
    
    return `
      <div class="log-card ${log.category || ''}">
        <div class="log-header">
          <div>
            <span class="log-action">${actionName}</span>
            <span class="log-category ${log.category || ''}">${log.category || 'Ø¹Ø§Ù…'}</span>
          </div>
          <div class="log-timestamp">${formattedDate} ${formattedTime}</div>
        </div>
        <div class="log-details">
          <strong>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</strong> ${log.admin}<br>
          ${details.user ? `<strong>Ø§Ù„ÙŠÙˆØ²Ø±:</strong> ${details.user}<br>` : ''}
          ${details.username ? `<strong>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${details.username}<br>` : ''}
          ${details.email ? `<strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${details.email}<br>` : ''}
          ${details.ticketType ? `<strong>Ù†ÙˆØ¹ Ø§Ù„ØªØ°ÙƒØ±Ø©:</strong> ${details.ticketType}<br>` : ''}
          ${details.ticketId ? `<strong>Ù…Ø¹Ø±Ù Ø§Ù„ØªØ°ÙƒØ±Ø©:</strong> ${details.ticketId}<br>` : ''}
          ${details.points ? `<strong>Ø§Ù„Ù†Ù‚Ø§Ø·:</strong> ${details.points}<br>` : ''}
          ${details.userId ? `<strong>Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${details.userId}<br>` : ''}
          ${details.code ? `<strong>Ø§Ù„ÙƒÙˆØ¯:</strong> ${details.code}<br>` : ''}
          ${details.changes ? `<strong>Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª:</strong> ${details.changes}<br>` : ''}
          ${details.query ? `<strong>Ø§Ù„Ø¨Ø­Ø«:</strong> ${details.query}<br>` : ''}
          ${details.filter ? `<strong>Ø§Ù„ÙÙ„ØªØ±:</strong> ${details.filter}<br>` : ''}
          ${details.from && details.to ? `<strong>Ù…Ù†:</strong> ${details.from} <strong>Ø¥Ù„Ù‰:</strong> ${details.to}<br>` : ''}
          ${details.action ? `<strong>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:</strong> ${details.action}<br>` : ''}
          ${details.verified !== undefined ? `<strong>Ø§Ù„ØªÙˆØ«ÙŠÙ‚:</strong> ${details.verified ? 'Ù…ÙˆØ«Ù‚' : 'ØºÙŠØ± Ù…ÙˆØ«Ù‚'}<br>` : ''}
        </div>
      </div>
    `;
  }).join('');
}

document.getElementById('closeModal').addEventListener('click', () => {
  document.getElementById('ticketModal').classList.remove('active');
});

document.getElementById('closeUserModal').addEventListener('click', () => {
  document.getElementById('userModal').classList.remove('active');
});

document.querySelectorAll('.filter-chip').forEach(chip => {
  chip.addEventListener('click', () => {
    if (chip.dataset.filter) {
      logAction('filter_tickets', 'filter', {
        filter: chip.dataset.filter,
        filterName: chip.textContent
      });
      
      document.querySelectorAll('.filter-chip[data-filter]').forEach(c => c.classList.remove('active'));
      chip.classList.add('active');
      currentFilter = chip.dataset.filter;
      filterTickets();
    } else if (chip.dataset.logFilter) {
      logAction('filter_logs', 'filter', {
        filter: chip.dataset.logFilter,
        filterName: chip.textContent
      });
      
      document.querySelectorAll('.filter-chip[data-log-filter]').forEach(c => c.classList.remove('active'));
      chip.classList.add('active');
      currentLogFilter = chip.dataset.logFilter;
      filterLogs();
    }
  });
});

document.getElementById('searchBox').addEventListener('input', (e) => {
  searchQuery = e.target.value;
  
  logAction('search_tickets', 'search', {
    query: searchQuery,
    resultsCount: allTickets.filter(t => {
      const query = searchQuery.toLowerCase();
      return t.id.toLowerCase().includes(query) ||
        t.fullName?.toLowerCase().includes(query) ||
        t.username?.toLowerCase().includes(query) ||
        t.email?.toLowerCase().includes(query) ||
        t.whatsapp?.toLowerCase().includes(query) ||
        t.phonezaincash?.toLowerCase().includes(query);
    }).length
  });
  
  filterTickets();
});

document.getElementById('userSearchBox').addEventListener('input', async (e) => {
  const query = e.target.value.toLowerCase();
  
  logAction('search_users', 'search', {
    query: query
  });
  
  try {
    const usersRef = ref(database, 'users');
    const usersSnap = await get(usersRef);
    
    if (usersSnap.exists()) {
      const usersData = usersSnap.val();
      const usersArray = Object.entries(usersData)
        .map(([id, data]) => ({id, ...data}))
        .filter(user => 
          user.user?.toLowerCase().includes(query) ||
          user.email?.toLowerCase().includes(query) ||
          user.phone?.toLowerCase().includes(query) ||
          user.invitecode?.toLowerCase().includes(query)
        );
      renderUsers(usersArray);
    }
  } catch (error) {
    console.error('Error searching users:', error);
  }
});

document.getElementById('codeSearchBox').addEventListener('input', (e) => {
  codeSearchQuery = e.target.value;
  
  logAction('search_codes', 'search', {
    query: codeSearchQuery
  });
  
  filterCodes();
});

document.getElementById('logSearchBox').addEventListener('input', (e) => {
  logSearchQuery = e.target.value;
  
  logAction('search_logs', 'search', {
    query: logSearchQuery
  });
  
  filterLogs();
});

loadTickets();
</script>

</body>
</html>
