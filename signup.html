<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<link rel="icon" href="/images/VOID.png" />
<title>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ - VOID</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --primary-purple:#5a28ff;
  --secondary-purple:#7b4dff;
  --accent-cyan:#00000000;
  --bg-dark:#081c39;
  --bg-darker:#0a0d14;
  --form-bg:rgba(0,0,0,0.65);
  --highlight:#6fffa3;
}

*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden}

@keyframes gradientShift{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

@keyframes float{
  0%,100%{transform:translateY(0) rotate(0deg)}
  50%{transform:translateY(-20px) rotate(5deg)}
}

@keyframes pulse{
  0%,100%{transform:scale(1);opacity:0.3}
  50%{transform:scale(1.1);opacity:0.6}
}

@keyframes fadeInUp{
  from{opacity:0;transform:translateY(30px)}
  to{opacity:1;transform:translateY(0)}
}

body{
  font-family:'Cairo',sans-serif;
  background:linear-gradient(135deg,#081c39 0%,#0a0d14 100%);
  background-size:400% 400%;
  animation:gradientShift 15s ease infinite;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  overflow-x:hidden;
  overflow-y:auto;
  padding:20px 10px;
}

body::before,body::after{
  content:'';
  position:fixed;
  border-radius:50%;
  filter:blur(100px);
  opacity:0.15;
  animation:float 8s ease-in-out infinite;
  pointer-events:none;
}

body::before{
  width:400px;
  height:400px;
  background:radial-gradient(circle,var(--primary-purple),transparent);
  top:-150px;
  right:-150px;
  animation-delay:0s;
}

body::after{
  width:350px;
  height:350px;
  background:radial-gradient(circle,var(--accent-cyan),transparent);
  bottom:-100px;
  left:-100px;
  animation-delay:4s;
}

.circle-decoration{
  position:fixed;
  border-radius:50%;
  border:2px solid rgba(90,40,255,0.2);
  animation:pulse 4s ease-in-out infinite;
  pointer-events:none;
}

.circle-1{width:250px;height:250px;top:10%;left:5%;animation-delay:0s}
.circle-2{width:180px;height:180px;bottom:15%;right:10%;animation-delay:2s}
.circle-3{width:120px;height:120px;top:50%;right:20%;animation-delay:1s}

.form{
  padding:1.8rem 1.5rem;
  max-width:360px;
  width:100%;
  background:rgba(0,0,0,0.65);
  border-radius:12px;
  box-shadow:0 0 30px rgba(90,40,255,0.4),
             0 10px 60px rgba(0,0,0,0.5),
             inset 0 1px 0 rgba(255,255,255,0.1);
  color:#fff;
  position:relative;
  z-index:10;
  backdrop-filter:blur(10px);
  border:1px solid rgba(90,40,255,0.3);
  animation:fadeInUp 0.6s ease-out;
  margin:auto;
}

.form::before{
  content:'';
  position:absolute;
  top:-2px;
  left:-2px;
  right:-2px;
  bottom:-2px;
  background:linear-gradient(45deg,var(--primary-purple),var(--accent-cyan),var(--secondary-purple));
  border-radius:12px;
  z-index:-1;
  opacity:0;
  transition:opacity 0.3s;
  background-size:400% 400%;
  animation:gradientShift 3s ease infinite;
}

.form:hover::before{
  opacity:0.4;
}

.form-title{
  font-size:0.9rem;
  text-align:center;
  margin-bottom:4px;
  opacity:0.95;
  letter-spacing:1px;
  animation:fadeInUp 0.8s ease-out;
}

.title-2{
  font-size:2.2rem;
  text-align:center;
  background:linear-gradient(135deg,var(--primary-purple),var(--accent-cyan));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  margin-bottom:20px;
  letter-spacing:6px;
  font-weight:bold;
  text-shadow:0 0 30px rgba(90,40,255,0.5);
  position:relative;
  animation:fadeInUp 1s ease-out;
}

.title-2::after{
  content:'';
  position:absolute;
  bottom:-6px;
  left:50%;
  transform:translateX(-50%);
  width:60px;
  height:2px;
  background:linear-gradient(90deg,transparent,var(--primary-purple),transparent);
  box-shadow:0 0 10px var(--primary-purple);
}

.input-container{
  margin-bottom:14px;
  position:relative;
  width:100%;
  animation:fadeInUp 1.2s ease-out;
}

.input-container input,
.input-container select{
  width:100%;
  padding:11px 13px;
  font-size:0.9rem;
  border-radius:8px;
  border:1px solid rgba(90,40,255,0.3);
  outline:none;
  background:rgba(255,255,255,0.05);
  color:#fff;
  transition:none;
  font-family:'Cairo',sans-serif;
}

.input-container input::placeholder{
  color:#aaa;
  opacity:0.85;
}

.input-container input:focus,
.input-container select:focus{
  border-color:rgba(90,40,255,0.5);
}

.phone-container{
  display:flex;
  gap:8px;
  align-items:center;
}

.phone-container select{
  width:100px;
  flex-shrink:0;
  padding:11px 8px;
  cursor:pointer;
  background:rgba(255,255,255,0.05);
  appearance:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 12 12'%3E%3Cpath fill='%23fff' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
  background-repeat:no-repeat;
  background-position:calc(100% - 8px) center;
  padding-right:24px;
  font-size:0.85rem;
}

.phone-container select option{
  background:rgba(10,13,20,0.98);
  color:#fff;
  padding:10px;
  font-size:0.85rem;
}

.phone-container input{
  flex:1;
}

.eye-btn{
  position:absolute;
  left:10px;
  top:50%;
  transform:translateY(-50%);
  background:transparent;
  border:none;
  color:#fff;
  font-size:1.1rem;
  cursor:pointer;
  padding:5px;
  border-radius:6px;
  z-index:5;
  transition:all 0.2s;
}

.eye-btn:hover{
  transform:translateY(-50%) scale(1.1);
  background:rgba(90,40,255,0.2);
}

.submit{
  width:100%;
  padding:12px;
  border-radius:8px;
  border:none;
  background:linear-gradient(135deg,var(--primary-purple),var(--secondary-purple));
  color:#fff;
  font-weight:bold;
  text-transform:uppercase;
  cursor:pointer;
  font-size:0.95rem;
  transition:all 0.3s ease;
  box-shadow:0 8px 30px rgba(90,40,255,0.3);
  position:relative;
  overflow:hidden;
  letter-spacing:2px;
  font-family:'Cairo',sans-serif;
  margin-top:6px;
  animation:fadeInUp 1.4s ease-out;
}

.submit::before{
  content:'';
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);
  transition:left 0.5s;
}

.submit:hover::before{
  left:100%;
}

.submit:hover{
  transform:translateY(-3px);
  box-shadow:0 12px 40px rgba(90,40,255,0.5);
}

.submit:active{
  transform:translateY(-1px) scale(0.98);
}

.submit:disabled{
  opacity:0.7;
  cursor:not-allowed;
}

.note-text{
  color:#ccc;
  text-align:center;
  cursor:pointer;
  margin:14px 0 10px 0;
  display:block;
  transition:all 0.3s;
  font-size:0.85rem;
  animation:fadeInUp 1.6s ease-out;
}

.note-text:hover{
  color:var(--accent-cyan);
  transform:translateY(-2px);
  text-shadow:0 0 10px rgba(0,217,255,0.5);
}

.msg{
  margin-top:10px;
  font-size:0.85rem;
  color:#ffcccc;
  min-height:1.2em;
  text-align:center;
  animation:fadeInUp 0.4s ease-out;
}

.msg.success{
  color:var(--highlight);
  text-shadow:0 0 10px rgba(111,255,163,0.5);
}

.msg .highlight{
  color:var(--accent-cyan);
  font-weight:bold;
}

.star{
  position:fixed;
  width:2px;
  height:2px;
  background:#fff;
  border-radius:50%;
  opacity:0.5;
  animation:twinkle 3s infinite;
  pointer-events:none;
}

@keyframes twinkle{
  0%,100%{opacity:0.3;transform:scale(1)}
  50%{opacity:1;transform:scale(1.5)}
}

.star:nth-child(1){top:20%;left:10%;animation-delay:0s}
.star:nth-child(2){top:60%;left:80%;animation-delay:1s}
.star:nth-child(3){top:80%;left:30%;animation-delay:2s}
.star:nth-child(4){top:40%;left:60%;animation-delay:1.5s}
.star:nth-child(5){top:10%;left:90%;animation-delay:0.5s}

@media (max-width: 480px){
  .form{
    padding:1.5rem 1.2rem;
    max-width:340px;
  }
  .title-2{
    font-size:2rem;
    letter-spacing:5px;
  }
  .phone-container select{
    width:95px;
    font-size:0.8rem;
  }
}
</style>
</head>
<body>

<div class="circle-decoration circle-1"></div>
<div class="circle-decoration circle-2"></div>
<div class="circle-decoration circle-3"></div>

<div class="star"></div>
<div class="star"></div>
<div class="star"></div>
<div class="star"></div>
<div class="star"></div>

<div class="form">
  <div class="form-title">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</div>
  <div class="title-2">VOID</div>

  <div class="input-container">
    <input id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ ÙÙ‚Ø·)" required />
  </div>

  <div class="input-container">
    <div class="phone-container">
      <select id="countryCode" required>
        <option value="+962">ğŸ‡¯ğŸ‡´ +962</option>
        <option value="+966">ğŸ‡¸ğŸ‡¦ +966</option>
        <option value="+971">ğŸ‡¦ğŸ‡ª +971</option>
        <option value="+974">ğŸ‡¶ğŸ‡¦ +974</option>
        <option value="+965">ğŸ‡°ğŸ‡¼ +965</option>
        <option value="+968">ğŸ‡´ğŸ‡² +968</option>
        <option value="+973">ğŸ‡§ğŸ‡­ +973</option>
        <option value="+20">ğŸ‡ªğŸ‡¬ +20</option>
        <option value="+961">ğŸ‡±ğŸ‡§ +961</option>
        <option value="+963">ğŸ‡¸ğŸ‡¾ +963</option>
        <option value="+964">ğŸ‡®ğŸ‡¶ +964</option>
        <option value="+967">ğŸ‡¾ğŸ‡ª +967</option>
        <option value="+970">ğŸ‡µğŸ‡¸ +970</option>
        <option value="+212">ğŸ‡²ğŸ‡¦ +212</option>
        <option value="+213">ğŸ‡©ğŸ‡¿ +213</option>
        <option value="+216">ğŸ‡¹ğŸ‡³ +216</option>
        <option value="+218">ğŸ‡±ğŸ‡¾ +218</option>
        <option value="+249">ğŸ‡¸ğŸ‡© +249</option>
        <option value="+1">ğŸ‡ºğŸ‡¸ +1</option>
        <option value="+44">ğŸ‡¬ğŸ‡§ +44</option>
      </select>
      <input id="phone" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required />
    </div>
  </div>

  <div class="input-container">
    <input id="email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required />
  </div>

  <div class="input-container">
    <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" required />
    <button type="button" class="eye-btn" id="togglePwd">ğŸ‘ï¸</button>
  </div>

  <button id="submitBtn" class="submit">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
  <div class="note-text" id="haveAccount">Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ</div>
  <div id="msg" class="msg"></div>
</div>

<script type="module">
import { app, analytics, auth, signInWithEmailAndPassword, signOut } from "./void.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  sendEmailVerification,
  fetchSignInMethodsForEmail
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { 
  getDatabase, 
  ref, 
  set, 
  get, 
  query, 
  orderByChild, 
  equalTo 
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const db = getDatabase(app);

const usernameEl = document.getElementById('username');
const countryCodeEl = document.getElementById('countryCode');
const phoneEl = document.getElementById('phone');
const emailEl = document.getElementById('email');
const pwdEl = document.getElementById('password');
const submitBtn = document.getElementById('submitBtn');
const msgEl = document.getElementById('msg');
const togglePwd = document.getElementById('togglePwd');
const haveAccount = document.getElementById('haveAccount');

togglePwd.addEventListener('click', () => {
  pwdEl.type = pwdEl.type === 'password' ? 'text' : 'password';
  togglePwd.textContent = pwdEl.type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
});

haveAccount.addEventListener('click', () => {
  window.location.href = 'index.html';
});

usernameEl.addEventListener('input', () => {
  const start = usernameEl.selectionStart;
  const end = usernameEl.selectionEnd;
  usernameEl.value = usernameEl.value.toLowerCase();
  usernameEl.setSelectionRange(start, end);
});

function showMsg(text, success=false){
  msgEl.innerHTML = text;
  msgEl.classList.toggle('success', success);
}

async function isUsernameTaken(username){
  const usersRef = ref(db, 'users');
  const q = query(usersRef, orderByChild('user'), equalTo(username));
  const snapshot = await get(q);
  return snapshot.exists();
}

function generateRandomCode(){
  const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  const numbers = '0123456789';
  let code = '';
  for(let i = 0; i < 3; i++){
    code += letters.charAt(Math.floor(Math.random() * letters.length));
  }
  for(let i = 0; i < 3; i++){
    code += numbers.charAt(Math.floor(Math.random() * numbers.length));
  }
  return code.split('').sort(() => Math.random() - 0.5).join('');
}

async function isInviteCodeTaken(code){
  const usersRef = ref(db, 'users');
  const q = query(usersRef, orderByChild('invitecode'), equalTo(code));
  const snapshot = await get(q);
  return snapshot.exists();
}

async function generateUniqueInviteCode(){
  const maxAttempts = 100;
  for(let attempt = 0; attempt < maxAttempts; attempt++){
    const code = generateRandomCode();
    const taken = await isInviteCodeTaken(code);
    if(!taken){
      return code;
    }
  }
  throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø¯Ø¹ÙˆØ© ÙØ±ÙŠØ¯');
}

submitBtn.addEventListener('click', async (e) => {
  e.preventDefault();
  showMsg('');
  submitBtn.disabled = true;
  const originalText = submitBtn.textContent;
  submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';

  const username = usernameEl.value.trim().toLowerCase();
  const countryCode = countryCodeEl.value;
  const phone = phoneEl.value.trim();
  const email = emailEl.value.trim().toLowerCase();
  const password = pwdEl.value;

  if(!username || !phone || !email || !password){
    showMsg('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ âš ï¸');
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
    return;
  }

  const englishOnly = /^[a-z0-9_]+$/.test(username);
  if(!englishOnly){
    showMsg('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø­Ø±ÙˆÙ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ØµØºÙŠØ±Ø© ÙˆØ£Ø±Ù‚Ø§Ù… ÙÙ‚Ø· âœï¸');
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
    return;
  }

  if(username.length < 4){
    showMsg('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 4 Ø£Ø­Ø±Ù Ø£Ùˆ Ø£ÙƒØ«Ø± âœï¸');
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
    return;
  }

  const phoneRegex = /^[0-9]{7,15}$/;
  if(!phoneRegex.test(phone)){
    showMsg('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø· (7-15 Ø±Ù‚Ù…) ğŸ“±');
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
    return;
  }

  if(password.length < 6){
    showMsg('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø£Ùˆ Ø£ÙƒØ«Ø± ğŸ”‘');
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
    return;
  }

  try {
    const taken = await isUsernameTaken(username);
    if(taken){
      showMsg('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ù‹Ø§ØŒ Ø§Ø®ØªØ± Ø§Ø³Ù… Ø¢Ø®Ø± âŒ');
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
      return;
    }

    const methods = await fetchSignInMethodsForEmail(auth, email);
    if(methods.length > 0){
      showMsg(`Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„ âš ï¸`);
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
      return;
    }

    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;
    const uid = user.uid;

    const fullPhone = countryCode + phone;
    const inviteCode = await generateUniqueInviteCode();

    await set(ref(db, 'users/' + uid), {
      email: email,
      phone: fullPhone,
      profile: 'https://res.cloudinary.com/dgoss36do/image/upload/v1764250946/us4iue3yneb7t6odft3x.png',
      updatedAt: Date.now(),
      user: username,
      verified: false,
      invitecode: inviteCode,
      vote: 0
    });

    await set(ref(db, 'requests/' + uid), {
      createdAt: Date.now()
    });

    await set(ref(db, 'invite/' + inviteCode), {
      allpoints: 0,
      allrequestspoints: 0,
      basic_ticket: {
        points: 0,
        requests_points: 0,
        use: ""
      },
      squad_ticket: {
        points: 0,
        requests_points: 0,
        use: ""
      },
      vip_ticket: {
        points: 0,
        requests_points: 0,
        use: ""
      }
    });

    await sendEmailVerification(user);
    await signOut(auth);

    showMsg('âœ¨ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨', true);
    setTimeout(()=> window.location.href='index.html', 3000);

  } catch(err){
    console.error(err);
    if(err.code === 'auth/email-already-in-use'){
      showMsg(`Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„ âš ï¸`);
    } else if(err.code === 'auth/weak-password'){
      showMsg('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹ ğŸ”‘');
    } else if(err.code === 'auth/invalid-email'){
      showMsg('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­ ğŸ“§');
    } else {
      showMsg('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + (err.message || err));
    }
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
  }
});
</script>
</body>
</html>
